<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Inventario Invernadero — Liceo San Nicolás</title>
  <link rel="stylesheet" href="css/styles.css"/>
  <script defer src="js/app.js"></script>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <span class="i i-green">
      <svg class="i-grad" viewBox="0 0 24 24" aria-hidden="true">
        <defs>
          <linearGradient id="g-green" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#00e676"/>
            <stop offset="100%" stop-color="#00bfa5"/>
          </linearGradient>
        </defs>
        <path fill="url(#g-green)"
          d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm1 14h-2v-2h2v2Zm0-4h-2V6h2v6Z"/>
      </svg>
    </span>
    <strong>Inventario Invernadero</strong>
    <span class="tag">Liceo San Nicolás</span>
  </div>

  <nav class="actions">
    <button id="autoBtn" class="btn btn-switch" title="Auto actualizar">
      <span class="i i-blue">
        <svg class="i-grad" viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <linearGradient id="g-blue" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#42a5f5"/>
              <stop offset="100%" stop-color="#1e88e5"/>
            </linearGradient>
          </defs>
          <path fill="url(#g-blue)"
            d="M12 6v3l4-4-4-4v3C7.58 4 4 7.58 4 12s3.58 8 8 8a8 8 0 0 0 7.75-6h-2.07A6 6 0 1 1 12 6Z"/>
        </svg>
      </span>
      <span class="switch-label">Auto: <b id="autoState">OFF</b></span>
    </button>

    <button id="importBtn" class="btn btn-purple">
      <span class="i i-purple">
        <svg class="i-grad" viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <linearGradient id="g-purple" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#a78bfa"/>
              <stop offset="100%" stop-color="#7c4dff"/>
            </linearGradient>
          </defs>
          <path fill="url(#g-purple)"
            d="M19 9h-4V3H9v6H5l7 7 7-7ZM5 18v2h14v-2H5Z"/>
        </svg>
      </span>
      Importar CSV
      <input id="fileInput" type="file" accept=".csv" hidden>
    </button>

    <button id="exportBtn" class="btn btn-orange">
      <span class="i i-orange">
        <svg class="i-grad" viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <linearGradient id="g-orange" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#ffb74d"/>
              <stop offset="100%" stop-color="#fb8c00"/>
            </linearGradient>
          </defs>
          <path fill="url(#g-orange)"
            d="M5 20h14v-2H5v2Zm7-16-7 7h4v6h6v-6h4l-7-7Z"/>
        </svg>
      </span>
      Exportar CSV
    </button>

    <button id="addBtn" class="btn btn-green">
      <span class="i i-green">
        <svg class="i-grad" viewBox="0 0 24 24" aria-hidden="true">
          <use href="#plus24"></use>
        </svg>
      </span>
      Añadir ítem
    </button>

    <button id="movBtn" class="btn btn-cyan">
      <span class="i i-cyan">
        <svg class="i-grad" viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <linearGradient id="g-cyan" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#26c6da"/>
              <stop offset="100%" stop-color="#00acc1"/>
            </linearGradient>
          </defs>
          <path fill="url(#g-cyan)"
            d="M5 4h14v2H5V4Zm0 7h14v2H5v-2Zm0 7h14v2H5v-2Z"/>
        </svg>
      </span>
      Asignaciones
    </button>
  </nav>
</header>

<svg style="display:none" aria-hidden="true">
  <symbol id="plus24" viewBox="0 0 24 24">
    <defs>
      <linearGradient id="g-lime" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#69f0ae"/>
        <stop offset="100%" stop-color="#00e676"/>
      </linearGradient>
    </defs>
    <path fill="url(#g-lime)" d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2h6Z"/>
  </symbol>
</svg>

<main class="wrap">
  <section class="kpis">
    <div class="kpi"><div class="kpi-h">Total ítems</div><div class="kpi-v" id="k_totalItems">0</div></div>
    <div class="kpi"><div class="kpi-h">Unidades</div><div class="kpi-v" id="k_unidades">0</div></div>
    <div class="kpi"><div class="kpi-h">Categorías</div><div class="kpi-v" id="k_categorias">0</div></div>
    <div class="kpi"><div class="kpi-h">Valor inventario (CLP)</div><div class="kpi-v" id="k_valor">$0</div></div>
  </section>

  <section class="filters">
    <input id="searchInput" class="input" placeholder="Buscar por nombre, código, profesor, curso o proyecto..."/>
    <select id="catFilter" class="input"></select>
    <select id="estadoFilter" class="input">
      <option value="">Todos los estados</option>
      <option value="Nuevo">Nuevo</option>
      <option value="Usado">Usado</option>
      <option value="Dañado">Dañado</option>
    </select>
    <select id="ubicFilter" class="input"></select>
  </section>

  <section class="table-wrap">
    <table class="table" id="itemsTable">
      <thead>
        <tr>
          <th>Código</th>
          <th>Nombre</th>
          <th>Categoría</th>
          <th>Profesor</th>
          <th>Curso</th>
          <th>Proyecto</th>
          <th>Unidad</th>
          <th>Cantidad</th>
          <th>Ubicación</th>
          <th>Proveedor</th>
          <th>Valor Unitario</th>
          <th>Valor Total</th>
          <th>Estado</th>
          <th>F. Ingreso</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </section>
</main>

<footer>
  <div>Creado por: Francisco Andrés Pinto Aravena — <a href="mailto:franciscoandresp@gmail.com">franciscoandresp@gmail.com</a></div>
  <div>Este proyecto es desarrollado con propósitos educacionales, motivando el desarrollo, culturización e innovación tecnológica en las aulas.</div>
  <div>© <span class="year"></span> Queda prohibida la copia, redistribución o adaptación de los contenidos, modelos 3D, imágenes y código aquí publicados sin autorización expresa por escrito.</div>
  <div>© Todos los derechos reservados.</div>
</footer>

<!-- Modal Ítem -->
<dialog id="itemModal">
  <form id="itemForm" method="dialog">
    <h3 id="modalTitle">Nuevo Ítem</h3>
    <div class="grid">
      <label>Código <input name="codigo" required></label>
      <label>Nombre <input name="nombre" required></label>
      <label>Categoría <input name="categoria" list="catList"></label>
      <label>Unidad <input name="unidad" placeholder="pza, caja, kg"></label>
      <label>Cantidad <input name="cantidad" type="number" min="0" step="any" value="1"></label>
      <label>Ubicación <input name="ubicacion" list="ubicList"></label>
      <label>Proveedor <input name="proveedor"></label>
      <label>Valor unitario (CLP) <input name="valorUnitario" type="number" min="0" step="any"></label>
      <label>Estado
        <select name="estado">
          <option value="Nuevo">Nuevo</option>
          <option value="Usado">Usado</option>
          <option value="Dañado">Dañado</option>
        </select>
      </label>
      <label>F. Ingreso <input name="fecha" type="date"></label>

      <!-- NUEVOS CAMPOS -->
      <label>Profesor responsable <input name="profesor" placeholder="Ej: Macarena Álvarez"></label>
      <label>Curso <input name="curso" placeholder="Ej: 3°A, 2°TP"></label>
      <label>Proyecto <input name="proyecto" placeholder="Ej: SIAMP, Ver con las Manos"></label>
    </div>

    <label>Observaciones
      <textarea name="obs" rows="3" placeholder="Notas, especificaciones, etc."></textarea>
    </label>

    <menu>
      <button type="reset" class="btn ghost" id="cancelBtn">Cancelar</button>
      <button type="submit" class="btn btn-green">Guardar</button>
    </menu>

    <datalist id="catList"></datalist>
    <datalist id="ubicList"></datalist>
  </form>
</dialog>

<!-- Modal Movimientos / Asignaciones -->
<dialog id="movModal">
  <form id="movForm" method="dialog">
    <h3>Asignación / Movimiento</h3>
    <div class="grid">
      <label>Fecha <input name="fecha" type="datetime-local"></label>
      <label>Tipo
        <select name="tipo">
          <option value="Consumo/Salida">Consumo/Salida</option>
          <option value="Devolución/Entrada">Devolución/Entrada</option>
          <option value="Reserva">Reserva (no afecta stock)</option>
        </select>
      </label>
      <label>Afecta Stock <input name="afecta" type="checkbox" checked></label>

      <label>Código Ítem <input name="codigo" list="codList" required></label>
      <label>Nombre Ítem <input name="nombre" readonly placeholder="Se completa por código"></label>
      <label>Cantidad <input name="cantidad" type="number" min="0" step="any" value="1"></label>

      <label>Profesor <input name="profesor" placeholder="Ej: Macarena Álvarez"></label>
      <label>Curso <input name="curso" placeholder="Ej: 3°A"></label>
      <label>Proyecto <input name="proyecto" placeholder="Ej: SIAMP"></label>
    </div>

    <label>Observaciones
      <textarea name="obs" rows="3" placeholder="Notas, detalle de uso, etc."></textarea>
    </label>

    <menu>
      <button type="button" class="btn ghost" id="movListBtn">Ver asignaciones</button>
      <span style="flex:1"></span>
      <button type="reset" class="btn ghost" id="movCancel">Cancelar</button>
      <button type="submit" class="btn btn-cyan">Guardar asignación</button>
    </menu>

    <datalist id="codList"></datalist>
  </form>
</dialog>

<!-- Modal Lista de Movimientos -->
<dialog id="movListModal">
  <div class="mov-header">
    <h3>Asignaciones registradas</h3>
    <div class="mov-actions">
      <input id="movSearch" class="input" placeholder="Buscar por profesor, curso, proyecto o código..."/>
      <button id="movExport" class="btn btn-orange">Exportar CSV</button>
      <button id="movClose" class="btn ghost">Cerrar</button>
    </div>
  </div>
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Fecha</th><th>Tipo</th><th>Código</th><th>Nombre</th>
          <th>Cant.</th><th>Profesor</th><th>Curso</th><th>Proyecto</th><th>Obs</th>
        </tr>
      </thead>
      <tbody id="movTbody"></tbody>
    </table>
  </div>
</dialog>

<template id="rowActions">
  <div class="row-actions">
    <button class="icon ghost" data-action="edit" title="Editar">
      ✏️
    </button>
    <button class="icon ghost" data-action="delete" title="Eliminar">
      🗑️
    </button>
    <button class="icon ghost" data-action="asignar" title="Asignar / movimiento">
      🔗
    </button>
  </div>
</template>

</body>
</html>
